includes
{
  #include "tcp.h"   
}

variables
{
  long sock;
  msTimer sendTimer;
  float steering_angle;
  float vehicle_speed;
}

on start
{
  sock = tcpOpen("127.0.0.1", 5000);
  setTimer(sendTimer, 100); 
}

on timer sendTimer
{
 
  steering_angle = getSignalValue("Vehicle.steeringAngle");
  vehicle_speed = getSignalValue("Vehicle.VehicleSpeed");

  char msg[100];
  format(msg, "%.2f,%.2f", steering_angle, vehicle_speed);

  tcpSend(sock, msg);

  setTimer(sendTimer, 100); 
}

on tcpEvent sock
{
  char response[100];
  int len = tcpReceive(sock, response, sizeof(response));

  if (len > 0)
  {
    write("Received from Python: %s", response);

    if (strcmp(response, "INTRUSION") == 0)
    {
      setSignalValue("HeadlightSystem.Alert", 1);
    }
  }
}
